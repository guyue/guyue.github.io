---
layout: post
title: Polymer——面向未来的Web组件开发
tags: 读书笔记
---

### 第一章 概述

Web组件技术将用户界面和逻辑封装在一起，以一种可重用的方式开发用户界面。

Web组件正在逐渐被主流接收，[Polymer](https://www.polymer-project.org/)小组走在了最前列，[Mozilla](http://x-tags.org/)也有自己的框架（[Mozilla or Microsoft释疑](http://stackoverflow.com/questions/33929771/microsofts-x-tag-vs-mozillas-x-tags)），社区的开发者们也在开发自己的实现方式。


#### 什么是Web组件

> Web组件是用来描述“一组允许开发者高效地表达已存在HTML元素实现”的技术集合的术语。  
> Web组件并不能解决所有问题，但给了开发者一种标准的方式，以将标签的实现打包封装。

Web组件关键概念列表

1. HTML模板

    > HTML模板是随时可以拿出来重复使用、序列化的文档对象模型（DOM）。可在`<template>`标签中编写模板片段（template之前的方式是：DOM节点对象创建、模板引擎、模板函数等）。

2. HTML引用

    > HTML引用用来在应用中接入被加载进来的独立代码片段，开发者只需要通过一个简单的`@include`就可以引用一个小型应用及其所有资源，而不用手动将其下载后再引用。

3. 自定义元素

    > 自定义元素，是在各框架、各平台和领域之间的一种通用、标准的元素生成方式。

4. Shadow DOM

    > Shadow DOM将Web组件中的DOM、样式和数据保护并封装起来，外界不能通过常规手段去改变。


#### 为什么使用Web组件

Web已经逐渐进化为了应用平台，HTML5以及一些新API的出现是Web正在进化为一个应用平台的证据。

> 严格地说，HTML5是一个简单的具有一些新元素的文档模型。然而，当人们谈及HTML5时，更多的是表示包含了新元素、CSS3和一些新的JavaScript API的集合。这些技术重新定义了Web开发。

Web组件通过定义一组新特性，以支持原生的扩展、抽象、引用和封装，允许开发者创建具有标准生命周期的可重用元素（构建网页的部件），并能被任意其他应用所引用。这项标准将为元素和应用之间建立清晰的关系，使创建和维护界面的过程更加平滑。


## 第一部分 UI核心概念

> 软件开发的“基础”是指对设计概念和实现模式的深刻理解。  
> 没有“基础”，开发出的软件不可避免的会漏洞百出。比如，由于对UI组件的布局、拖动、缩放等核心概念的误解而写出失败的代码，因为低效的设计或对标准设计模式理解有误而写出糟糕的API和实现等等。


### 第2章 基础知识

> 编写Voltron组件基类的目的是，提供一套用于构建DOM库的标准，这种标准无关具体实现——比如JavaScript控件、纯Web组件、Polymer组件，等等。

#### DOM抽象层的重要性

直接使用DOM的API很繁琐，尤其当需要兼容多浏览器的时候。jQuery是最著名和最被广泛使用的DOM库，实现了一个完善的DOM库的通用功能，DOM选择器、DOM元素遍历和DOM元素操作等。

#### 控件的API和生命周期

控件应该保持一致的API和通用的生命周期，遵循统一的模式，保持同样的行为，以便于开发、维护和使用。控件的生命周期包括但不限于以下几个阶段：初始化、渲染、事件绑定、销毁等。

完善的API函数需要预设恰当的默认参数，并通过事件允许开发者切入控件的某些阶段实现需求。

#### 继承模式

JavaScript使用原型继承，即直接继承自另一个对象；在类继承体系中，对象是通过类创建的，继承自类。

#### 依赖

当创建一个Web组件时，应该尽最大的努力来限制控件对其他模块的依赖。在添加一项依赖之前，应当充分评估，其所带来的价值是否超过了它的体积和维护成本，这些负担将由控件的使用者来承担。

#### 优化

> 过早优化是万恶之源
> —— Donald Knuth 

当应用的规模足够大时，理解整个应用的生命周期是不可能的。由此更突出控件一致的API和通用的生命周期的重要性。

UI控件基类Voltron主要包括渲染、事件绑定/解绑定、销毁等阶段，并实现一套通用的接口便于扩展和适配这些概念。大部分软件的UI层都包括构建、继承、初始化等概念。控件提供了对应阶段的事件，以便于在实现API细节的过程中，定期的运行性能测试。

在编写代码时要遵循某些最佳实践，比如批量更新DOM，在实现API的过程中进行性能测试，当性能问题显现后再进一步优化。如果你的设计足够合理，那么在软件开发后期性能瓶颈显现之时，你可以单独的优化每一个模块。

#### Web组件不仅仅是JavaScript

Web组件希望解决的是更大的问题——将HTML、CSS、JavaScript封装成一个可扩展的不影响周围DOM节点的集合。通过这种封装、声明性的实现，将Web从一个准开发平台升级为一个真正的开发平台。

#### 示例控件

##### Voltron控件基类
[voltron.js](https://github.com/WebComponentsBook/chapter-2_dialog/blob/master/components/chapter-2_voltron/voltron.js)

##### 对话框类
[dialog.js](https://github.com/WebComponentsBook/chapter-2_dialog/blob/master/dialog.js)

##### 对话框的CSS和HTML
[index.html](https://github.com/WebComponentsBook/chapter-2_dialog/blob/master/index.html)

#### 总结

定义一个具有通用生命周期的控件基类，使应用开发更易于开发、维护、调试，规定插件预期的输出和行为。

### 第3章 文档流和定位

### 第4章 理解和操作z-index

## 第二部分 构建UI

### 第5章 克隆节点

### 第6章 创建浮层

### 第7章 拖动元素

### 第8章 调整元素尺寸

### 第9章 完成对话框控件

## 第三部分 构建HTML5 Web组件

### 第10章 模板

### 第11章 Shadow DOM

### 第12章 自定义元素

### 第13章 引入文档

## 第四部分 使用Polymer测试、构建、部署Web组件

### 第14章 Polymer简介

### 第15章 将对话框迁移至Polymer

### 第16章 测试Web组件

### 第17章 打包和发布

### 第18章 结语
